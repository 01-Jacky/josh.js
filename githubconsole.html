<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="chrome=1">
  <title>Josh.js by sdether</title>
  <link rel="stylesheet" href="stylesheets/styles.css">
  <link rel="stylesheet" href="stylesheets/pygment_trac.css">
  <script src="javascripts/respond.js"></script>
  <!--[if lt IE 9]>
  <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
  <!--[if lt IE 8]>
  <link rel="stylesheet" href="stylesheets/ie.css">
  <![endif]-->
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
  <link href='http://fonts.googleapis.com/css?family=Source+Code+Pro' rel='stylesheet' type='text/css'>
  <link rel="stylesheet" href="http://code.jquery.com/ui/1.9.2/themes/base/jquery-ui.css">
  <link rel="stylesheet" href="stylesheets/githubconsole.css">
  <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.0/jquery.min.js"></script>
  <script src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.9.2/jquery-ui.min.js"></script>
  <script src="http://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.4.2/underscore-min.js"></script>
  <script>Josh = {Debug: true };</script>
  <script src="javascripts/killring.js"></script>
  <script src="javascripts/history.js"></script>
  <script src="javascripts/readline.js"></script>
  <script src="javascripts/shell.js"></script>
  <script src="javascripts/pathhandler.js"></script>
  <script src="javascripts/githubconsole.js"></script>
</head>
<body>
<div id="shell-container">
  <div id=shell-status>Github rate limit: <span id="ratelimit"></span></div>
  <div id="shell-panel">
    <div>Type <code>help</code> or hit <code>TAB</code> for a list of commands. Press
      <code>Ctrl-C</code> to hide the console.
    </div>
    <div id="shell-view"></div>

  </div>
</div>
<div id="header">
  <nav>
    <li><a href="index.html">Back to the Documentation</a></li>
  </nav>
</div>
<div class="wrapper">

  <section>
    <h1>Github Console</h1>

    <p>This tutorial expands on the
      <a href="quakeconsole.html">Quake Console</a> tutorial by using the GitHub REST API instead of a faked filesystem. how to wire up a console that uses a remote API.
    </p>

    <h2>Try out the Console</h2>

    <p>Type <code>~</code> to activate the shell we will be building in this tutorial.</p>

    <p>You can explore the current repository's file system via the standard <code>ls</code> and
      <code>cd</code> commands as well as take advantage of path <code>TAB</code> completion. Additional commands are:
    </p>
    <ul>
      <li><code>user</code> - show the current user's info</li>
      <li><code>user <em>username</em></code> - change the user to explore</li>
      <li><code>repo -l</code> - list the current user's repositories</li>
      <li><code>repo <em>repository_name</em></code> - change the repository to explore (supports
        <code>TAB</code> completion)
      </li>
      <li><code>branch -l</code> - list the current repository's branches</li>
      <li><code>branch <em>branch_name</em></code> - change the branch to explore (supports <code>TAB</code> completion)
      </li>
    </ul>

    <p>You will be limited to 60 requests/hour to the API (where each console command may use multipl requests). If you
      <a href='http://josh.claassen.net/github'>authenticate via GitHub</a>, you will have a more flexible 5000 requests/hour to play with.
    </p>

    <h2>Application State</h2>

    <p>In order for file system commands to always be available, the console must always have a current repository, which in turn means we'll always have an active user. That means that at any point in time, we will have the current user object, the list of all the user's repositories, and the root of the current branch as state. Changing users, picks a default repository and branch, so that we are never in state without this full state. Branches and current directory information are loaded on demand.</p>
    <pre>
{
  api: "https://api.github.com/",
  access_token: $access_token_of_authenticated_user_if_any,
  shell: $instance_of_Josh.Shell,
  pathhandler: $instance_of_Josh.PathHandler,
  user: $current_user_object,
  repo: $current_repository,
  repos: $list_of_user_repos,
  branch: $current_branch,
  branches: $lazy_initialized_list_of_branches_for_current_repo
}</pre>

    <h2>The GitHub API</h2>

    <p>GitHub provides a
      <a href="http://developer.github.com/v3/">REST API</a>, giving access to most of its data and functionality. We're just going to worry about read capability around repositories, since each repo is basically a file system and plays directly into
      <code>PathHandler</code>'s area of use.</p>

    <p>The user object comes from:</p>
    <pre>GET /users/:user</pre>
    <p>or during authenticated initialization from:</p>
    <pre>GET /user</pre>
    <p>We never fetch an individual repository, instead opting to fetch all for the current user at user initialization via:</p>
    <pre>GET /users/:user/repos</pre>
    <p>We do the same for branches, fetching all, lazily, once we need to list them:</p>
    <pre>GET /repos/:owner/:repo/branches</pre>
    <p>Finally, we fetch the current directory via</p>
    <pre>GET /repos/:owner/:repo/contents/:path</pre>
    <p>This is done for the root during repo initialization, and for path completion and <code>cd</code>, on demand.</p>

    <p> The API returns <em>json</em>, which is perfect for us as well. It is on another domain, so we will be using
      <em>jsonp</em> requests, rather than straight ajax for json payloads. Usually you would be integrating with your own API or at least one that allows cross-domain requests.
    </p>

    <p>The one complication to address is that GitHub limits non-authenticated requests to 60/hour, which playing with this console quickly exhausts. For this reason, we also have an oauth code path going through a companion site to let users authenticate and let us make authenticated requests. The oauth is outside the scope of this tutorial, but the node.js app to handle the authentication is on the josh.js
      <a href="https://github.com/sdether/josh.js/tree/github-authentication-backend">github-authentication-backend</a> branch.
    </p>


  </section>
</div>
<!--[if !IE]>
<script>fixScale(document);</script><![endif]-->

</body>
</html>