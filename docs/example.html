<!DOCTYPE html>  <html> <head>   <title>example.js</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               example.js             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre><span class="cm">/*------------------------------------------------------------------------*</span>
<span class="cm"> * Copyright 2013 Arne F. Claassen</span>
<span class="cm"> *</span>
<span class="cm"> * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span>
<span class="cm"> * you may not use this file except in compliance with the License.</span>
<span class="cm"> * You may obtain a copy of the License at</span>
<span class="cm"> *</span>
<span class="cm"> *   http://www.apache.org/licenses/LICENSE-2.0</span>

<span class="cm"> * Unless required by applicable law or agreed to in writing, software</span>
<span class="cm"> * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span>
<span class="cm"> * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<span class="cm"> * See the License for the specific language governing permissions and</span>
<span class="cm"> * limitations under the License.</span>
<span class="cm"> *-------------------------------------------------------------------------*/</span>
<span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">root</span><span class="p">,</span> <span class="nx">$</span><span class="p">,</span> <span class="nx">_</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">Josh</span><span class="p">.</span><span class="nx">Example</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">root</span><span class="p">,</span> <span class="nx">$</span><span class="p">,</span> <span class="nx">_</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <p>Enable console debugging, when Josh.Debug is set and there is a console object on the document root.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="kd">var</span> <span class="nx">_console</span> <span class="o">=</span> <span class="p">(</span><span class="nx">Josh</span><span class="p">.</span><span class="nx">Debug</span> <span class="o">&amp;&amp;</span> <span class="nx">root</span><span class="p">.</span><span class="nx">console</span><span class="p">)</span> <span class="o">?</span> <span class="nx">root</span><span class="p">.</span><span class="nx">console</span> <span class="o">:</span> <span class="p">{</span>
      <span class="nx">log</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="p">}</span>
    <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <h2>Setup of Shell</h2>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>build the <em>fake</em> directory structure used to illustrate path commands and completions.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="kd">var</span> <span class="nx">treeroot</span> <span class="o">=</span> <span class="nx">buildTree</span><span class="p">();</span></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>Create <code>History</code> and <code>KillRing</code> by hand since we will use the <code>KillRing</code> for an example command.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="kd">var</span> <span class="nx">history</span> <span class="o">=</span> <span class="nx">Josh</span><span class="p">.</span><span class="nx">History</span><span class="p">();</span>
    <span class="kd">var</span> <span class="nx">killring</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Josh</span><span class="p">.</span><span class="nx">KillRing</span><span class="p">();</span></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>Create the <code>ReadLine</code> instance by hand so that we can provide it our <code>KillRing</code>. Since the shell needs to share
the <code>History</code> object with <code>ReadLine</code> and <code>Shell</code> isn't getting to create <code>ReadLine</code> automatically as it usually does
we need to pass in <code>History</code> into <code>ReadLine</code> as well.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="kd">var</span> <span class="nx">readline</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Josh</span><span class="p">.</span><span class="nx">ReadLine</span><span class="p">({</span><span class="nx">history</span><span class="o">:</span> <span class="nx">history</span><span class="p">,</span> <span class="nx">killring</span><span class="o">:</span> <span class="nx">killring</span><span class="p">,</span> <span class="nx">console</span><span class="o">:</span> <span class="nx">_console</span> <span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>Finally, create the <code>Shell</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="kd">var</span> <span class="nx">shell</span> <span class="o">=</span> <span class="nx">Josh</span><span class="p">.</span><span class="nx">Shell</span><span class="p">({</span><span class="nx">readline</span><span class="o">:</span> <span class="nx">readline</span><span class="p">,</span> <span class="nx">history</span><span class="o">:</span> <span class="nx">history</span><span class="p">,</span> <span class="nx">console</span><span class="o">:</span> <span class="nx">_console</span><span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <h2>Create <em>killring</em> command</h2>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p>Setup the <code>Underscore</code> template for displaying items in the <code>KillRing</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="kd">var</span> <span class="nx">killringItemTemplate</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">template</span><span class="p">(</span><span class="s2">&quot;&lt;div&gt;&lt;% _.each(items, function(item, i) { %&gt;&lt;div&gt;&lt;%- i %&gt;&amp;nbsp;&lt;%- item %&gt;&lt;/div&gt;&lt;% }); %&gt;&lt;/div&gt;&quot;</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>Create a the command <code>killring</code> which will display all text currently in the <code>KillRing</code>, by attaching
a handler to the <code>Shell</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">shell</span><span class="p">.</span><span class="nx">setCommandHandler</span><span class="p">(</span><span class="s2">&quot;killring&quot;</span><span class="p">,</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p>We don't implement any completion for the <code>killring</code> command, so we only provide an <code>exec</code> handler, and no <code>completion</code> handler.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">exec</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">cmd</span><span class="p">,</span> <span class="nx">args</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <p><code>killring</code> takes one optional argument <strong>-c</strong> which clears the killring (just like <strong>history -c</strong>).</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">if</span><span class="p">(</span><span class="nx">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;-c&quot;</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">killring</span><span class="p">.</span><span class="nx">clear</span><span class="p">();</span></pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <p>The callback of an <code>exec</code> handler expects the html to display as result of executing the command. Clearing the
killing has no output, so we just call the callback and exit the handler.</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="nx">callback</span><span class="p">();</span>
          <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <p>Return the output of feeding all items from the killring into our template.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">callback</span><span class="p">(</span><span class="nx">killringItemTemplate</span><span class="p">({</span><span class="nx">items</span><span class="o">:</span> <span class="nx">killring</span><span class="p">.</span><span class="nx">items</span><span class="p">()}));</span>
      <span class="p">}</span>
    <span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <h2>Setup PathHandler</h2>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <p><code>PathHandler</code> is a mix-in for <code>Shell</code> to provide provide the standard unix <code>ls</code>, <code>pwd</code> and <code>cd</code> commands, as well
as standard <em>bash</em>-style path tab-completion. It expects a <code>Shell</code> instance as its first argument so that it can
attach its command handlers to the shell as well as overrride the default handler to support completion of path's
starting with <code>.</code> or <code>/</code> without a leading command.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="kd">var</span> <span class="nx">pathhandler</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Josh</span><span class="p">.</span><span class="nx">PathHandler</span><span class="p">(</span><span class="nx">shell</span><span class="p">,</span> <span class="p">{</span><span class="nx">console</span><span class="o">:</span> <span class="nx">_console</span><span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>               <p><code>PathHandler</code> operates on path nodes which are expected to be objects with the minimum structure of</p>

<pre><code>{
  name: 'localname',
  path: '/full/path/to/localname'
}
</code></pre>

<p>where name is the <code>name</code> of the node and <code>path</code> is the absolute path to the node. PathHandler does not modify
these nodes, so any additional state your implementation requires can be attached to the nodes and be relied on
being part of the node when received by the handling methods you implement.</p>

<p>The pathhandler expects to be initialized with the current <em>directory</em>, i.e. a path node.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">pathhandler</span><span class="p">.</span><span class="nx">current</span> <span class="o">=</span> <span class="nx">treeroot</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-18">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-18">&#182;</a>               </div>               <p><code>PathHandler</code> requires two method, <code>getNode</code> and <code>getChildNodes</code>, to be provided in order to operate.</p>

<p><code>getNode</code> gets called with <em>path</em> string. This string is completely opaque to <code>PathHandler</code>, i.e. constructs such
as <code>.</code> and <code>..</code> are an implementation detail. <code>PathHandler</code> does assume that the path separator is <code>/</code>. <code>getNode</code>
is called anytime the pathhandler has a path and need to determine what if any node exists at that path which happens
during path completion as well as <code>cd</code> and <code>ls</code> execution.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">pathhandler</span><span class="p">.</span><span class="nx">getNode</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">path</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">path</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">callback</span><span class="p">(</span><span class="nx">pathhandler</span><span class="p">.</span><span class="nx">current</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="kd">var</span> <span class="nx">parts</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">),</span> <span class="kd">function</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">x</span><span class="p">;</span>
      <span class="p">});</span>
      <span class="kd">var</span> <span class="nx">start</span> <span class="o">=</span> <span class="p">((</span><span class="nx">path</span> <span class="o">||</span> <span class="s1">&#39;&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;/&#39;</span><span class="p">)</span> <span class="o">?</span> <span class="nx">treeroot</span> <span class="o">:</span> <span class="nx">pathhandler</span><span class="p">.</span><span class="nx">current</span><span class="p">;</span>
      <span class="nx">_console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;start: &#39;</span> <span class="o">+</span> <span class="nx">start</span><span class="p">.</span><span class="nx">path</span> <span class="o">+</span> <span class="s1">&#39;, parts: &#39;</span> <span class="o">+</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">parts</span><span class="p">));</span>
      <span class="k">return</span> <span class="nx">findNode</span><span class="p">(</span><span class="nx">start</span><span class="p">,</span> <span class="nx">parts</span><span class="p">,</span> <span class="nx">callback</span><span class="p">);</span>
    <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-19">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-19">&#182;</a>               </div>               <p><code>getChildNodes</code> is used by path completion to determine the possible completion candidates. Path completion first
determines the node for the given path, looking for the nearest <code>/</code> in case if the given path does not return a
node via <code>getNode</code>. For our example, we've attached the child node objects directly to the node object, so we
can simply return it. Usually this would be used to call the server with the provided node's path or id so that
the appropriate children can be found.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">pathhandler</span><span class="p">.</span><span class="nx">getChildNodes</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">_console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;children for &quot;</span> <span class="o">+</span> <span class="nx">node</span><span class="p">.</span><span class="nx">name</span><span class="p">);</span>
      <span class="nx">callback</span><span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">childnodes</span><span class="p">);</span>
    <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-20">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-20">&#182;</a>               </div>               <p><code>findNode</code> is called recursively from <code>getNode</code> with the current node and remaining path already split into
segments. It then simply resolves the node for the next segment in <code>parts</code> to a node, including relative
references like <code>.</code> and <code>..</code>. In implementations that let you explore an hierarchy on a server, this function
would live on the server side and be called remotely via <code>getNode</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="kd">function</span> <span class="nx">findNode</span><span class="p">(</span><span class="nx">current</span><span class="p">,</span> <span class="nx">parts</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">parts</span> <span class="o">||</span> <span class="nx">parts</span><span class="p">.</span><span class="nx">length</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">callback</span><span class="p">(</span><span class="nx">current</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="k">if</span><span class="p">(</span><span class="nx">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;.&quot;</span><span class="p">)</span> <span class="p">{</span>

      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="nx">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;..&quot;</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">current</span> <span class="o">=</span> <span class="nx">current</span><span class="p">.</span><span class="nx">parent</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">current</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">first</span><span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">current</span><span class="p">.</span><span class="nx">childnodes</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">node</span><span class="p">.</span><span class="nx">name</span> <span class="o">==</span> <span class="nx">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
        <span class="p">}));</span>
      <span class="p">}</span>
      <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">current</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">callback</span><span class="p">();</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">findNode</span><span class="p">(</span><span class="nx">current</span><span class="p">,</span> <span class="nx">_</span><span class="p">.</span><span class="nx">rest</span><span class="p">(</span><span class="nx">parts</span><span class="p">),</span> <span class="nx">callback</span><span class="p">);</span>
    <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-21">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-21">&#182;</a>               </div>               <h2>Setup Document Behavior</h2>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-22">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-22">&#182;</a>               </div>               <p>Activation and display behavior happens at document ready time.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">ready</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-23">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-23">&#182;</a>               </div>               <p>The default name for the div the shell uses as its container is <code>shell-panel</code>, although that can be changed via
the shell config parameter <code>shell-panel-id</code>. The <code>Shell</code> display model relies on a 'panel' to contain a 'view'.
The 'panel' acts as the view-port, i.e. the visible portion of the shell content, while the 'view' is appended
to and scrolled up as new content is added.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="kd">var</span> <span class="nx">$consolePanel</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#shell-panel&#39;</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-24">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-24">&#182;</a>               </div>               <p>We use <strong>jquery-ui</strong>'s <code>resizable</code> to let us drag the bottom edge of the console up and down.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">$consolePanel</span><span class="p">.</span><span class="nx">resizable</span><span class="p">({</span> <span class="nx">handles</span><span class="o">:</span> <span class="s2">&quot;s&quot;</span><span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-25">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-25">&#182;</a>               </div>               <p>activate the shell</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">shell</span><span class="p">.</span><span class="nx">activate</span><span class="p">();</span>
    <span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-26">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-26">&#182;</a>               </div>               <p>We attach the various objects we've created here to <code>Josh.Instance</code> purely so they can be inspected via a
javascript console. This is not required for the functionality of the example.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">Josh</span><span class="p">.</span><span class="nx">Instance</span> <span class="o">=</span> <span class="p">{</span>
      <span class="nx">Tree</span><span class="o">:</span> <span class="nx">treeroot</span><span class="p">,</span>
      <span class="nx">Shell</span><span class="o">:</span> <span class="nx">shell</span><span class="p">,</span>
      <span class="nx">PathHandler</span><span class="o">:</span> <span class="nx">pathhandler</span><span class="p">,</span>
      <span class="nx">KillRing</span><span class="o">:</span> <span class="nx">killring</span>
    <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-27">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-27">&#182;</a>               </div>               <p>This code builds our <em>fake</em> directory structure. Since most real applications of <code>Josh</code> would not keep their
entire hierarchy in memory, but instead make callbacks to a server to find nodes and node children, the details
of this function are of little interest.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="kd">function</span> <span class="nx">buildTree</span><span class="p">()</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">fs</span> <span class="o">=</span> <span class="p">{</span>
        <span class="nx">bin</span><span class="o">:</span> <span class="p">{},</span>
        <span class="nx">boot</span><span class="o">:</span> <span class="p">{},</span>
        <span class="nx">dev</span><span class="o">:</span> <span class="p">{},</span>
        <span class="nx">etc</span><span class="o">:</span> <span class="p">{</span>
          <span class="k">default</span><span class="o">:</span> <span class="p">{},</span>
          <span class="s1">&#39;rc.d&#39;</span><span class="o">:</span> <span class="p">{},</span>
          <span class="nx">sysconfig</span><span class="o">:</span> <span class="p">{},</span>
          <span class="nx">x11</span><span class="o">:</span> <span class="p">{}</span>
        <span class="p">},</span>
        <span class="nx">home</span><span class="o">:</span> <span class="p">{</span>
          <span class="nx">bob</span><span class="o">:</span> <span class="p">{</span>
            <span class="nx">video</span><span class="o">:</span> <span class="p">{</span>
              <span class="s1">&#39;firefly.m4v&#39;</span><span class="o">:</span> <span class="p">{}</span>
            <span class="p">},</span>
            <span class="nx">videos</span><span class="o">:</span> <span class="p">{</span>
              <span class="s1">&#39;Arrested Development&#39;</span><span class="o">:</span> <span class="p">{</span>
                <span class="s1">&#39;s1e1.m4v&#39;</span><span class="o">:</span> <span class="p">{}</span>
              <span class="p">},</span>
              <span class="s1">&#39;Better Off Ted&#39;</span><span class="o">:</span> <span class="p">{</span>
                <span class="s1">&#39;s1e1.m4v&#39;</span><span class="o">:</span> <span class="p">{}</span>
              <span class="p">}</span>
            <span class="p">}</span>
          <span class="p">},</span>
          <span class="nx">jane</span><span class="o">:</span> <span class="p">{}</span>
        <span class="p">},</span>
        <span class="nx">lib</span><span class="o">:</span> <span class="p">{},</span>
        <span class="s1">&#39;lost+found&#39;</span><span class="o">:</span> <span class="p">{},</span>
        <span class="nx">misc</span><span class="o">:</span> <span class="p">{},</span>
        <span class="nx">mnt</span><span class="o">:</span> <span class="p">{</span>
          <span class="nx">cdrom</span><span class="o">:</span> <span class="p">{},</span>
          <span class="nx">sysimage</span><span class="o">:</span> <span class="p">{}</span>
        <span class="p">},</span>
        <span class="nx">net</span><span class="o">:</span> <span class="p">{},</span>
        <span class="nx">opt</span><span class="o">:</span> <span class="p">{},</span>
        <span class="nx">proc</span><span class="o">:</span> <span class="p">{},</span>
        <span class="nx">root</span><span class="o">:</span> <span class="p">{},</span>
        <span class="nx">sbin</span><span class="o">:</span> <span class="p">{},</span>
        <span class="nx">usr</span><span class="o">:</span> <span class="p">{</span>
          <span class="nx">x11</span><span class="o">:</span> <span class="p">{},</span>
          <span class="nx">bin</span><span class="o">:</span> <span class="p">{},</span>
          <span class="nx">include</span><span class="o">:</span> <span class="p">{},</span>
          <span class="nx">lib</span><span class="o">:</span> <span class="p">{},</span>
          <span class="nx">local</span><span class="o">:</span> <span class="p">{},</span>
          <span class="nx">man</span><span class="o">:</span> <span class="p">{},</span>
          <span class="nx">sbin</span><span class="o">:</span> <span class="p">{},</span>
          <span class="nx">share</span><span class="o">:</span> <span class="p">{</span>
            <span class="nx">doc</span><span class="o">:</span> <span class="p">{}</span>
          <span class="p">},</span>
          <span class="nx">src</span><span class="o">:</span> <span class="p">{}</span>
        <span class="p">},</span>
        <span class="kd">var</span><span class="o">:</span> <span class="p">{</span>
          <span class="nx">lib</span><span class="o">:</span> <span class="p">{},</span>
          <span class="nx">lock</span><span class="o">:</span> <span class="p">{},</span>
          <span class="nx">run</span><span class="o">:</span> <span class="p">{},</span>
          <span class="nx">log</span><span class="o">:</span> <span class="p">{</span>
            <span class="nx">httpd</span><span class="o">:</span> <span class="p">{</span>
              <span class="nx">access_log</span><span class="o">:</span> <span class="p">{},</span>
              <span class="nx">error_log</span><span class="o">:</span> <span class="p">{}</span>
            <span class="p">},</span>
            <span class="s1">&#39;boot.log&#39;</span><span class="o">:</span> <span class="p">{},</span>
            <span class="nx">cron</span><span class="o">:</span> <span class="p">{},</span>
            <span class="nx">messages</span><span class="o">:</span> <span class="p">{}</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">};</span>

      <span class="kd">function</span> <span class="nx">build</span><span class="p">(</span><span class="nx">parent</span><span class="p">,</span> <span class="nx">node</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">parent</span><span class="p">.</span><span class="nx">childnodes</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">pairs</span><span class="p">(</span><span class="nx">node</span><span class="p">),</span> <span class="kd">function</span><span class="p">(</span><span class="nx">pair</span><span class="p">)</span> <span class="p">{</span>
          <span class="kd">var</span> <span class="nx">child</span> <span class="o">=</span> <span class="p">{</span>
            <span class="nx">name</span><span class="o">:</span> <span class="nx">pair</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="nx">path</span><span class="o">:</span> <span class="nx">parent</span><span class="p">.</span><span class="nx">path</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="nx">pair</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="nx">parent</span><span class="o">:</span> <span class="nx">parent</span>
          <span class="p">};</span>
          <span class="nx">build</span><span class="p">(</span><span class="nx">child</span><span class="p">,</span> <span class="nx">pair</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
          <span class="k">return</span> <span class="nx">child</span><span class="p">;</span>
        <span class="p">});</span>
        <span class="nx">parent</span><span class="p">.</span><span class="nx">children</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="nx">node</span><span class="p">);</span>
        <span class="k">return</span> <span class="nx">parent</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="kd">var</span> <span class="nx">tree</span> <span class="o">=</span> <span class="nx">build</span><span class="p">({</span><span class="nx">name</span><span class="o">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="nx">path</span><span class="o">:</span> <span class="s2">&quot;&quot;</span><span class="p">},</span> <span class="nx">fs</span><span class="p">);</span>
      <span class="nx">tree</span><span class="p">.</span><span class="nx">path</span> <span class="o">=</span> <span class="s1">&#39;/&#39;</span><span class="p">;</span>
      <span class="k">return</span> <span class="nx">tree</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">})(</span><span class="nx">root</span><span class="p">,</span> <span class="nx">$</span><span class="p">,</span> <span class="nx">_</span><span class="p">);</span>
<span class="p">})(</span><span class="k">this</span><span class="p">,</span> <span class="nx">$</span><span class="p">,</span> <span class="nx">_</span><span class="p">);</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div>

<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-39420675-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
</body> </html>