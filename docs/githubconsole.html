<!DOCTYPE html>  <html> <head>   <title>githubconsole.js</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               githubconsole.js             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre><span class="cm">/*------------------------------------------------------------------------*</span>
<span class="cm"> * Copyright 2013 Arne F. Claassen</span>
<span class="cm"> *</span>
<span class="cm"> * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span>
<span class="cm"> * you may not use this file except in compliance with the License.</span>
<span class="cm"> * You may obtain a copy of the License at</span>
<span class="cm"> *</span>
<span class="cm"> *   http://www.apache.org/licenses/LICENSE-2.0</span>

<span class="cm"> * Unless required by applicable law or agreed to in writing, software</span>
<span class="cm"> * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span>
<span class="cm"> * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<span class="cm"> * See the License for the specific language governing permissions and</span>
<span class="cm"> * limitations under the License.</span>
<span class="cm"> *-------------------------------------------------------------------------*/</span>
<span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">root</span><span class="p">,</span> <span class="nx">$</span><span class="p">,</span> <span class="nx">_</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">Josh</span><span class="p">.</span><span class="nx">GitHubConsole</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">root</span><span class="p">,</span> <span class="nx">$</span><span class="p">,</span> <span class="nx">_</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <p>Enable console debugging, when Josh.Debug is set and there is a console object on the document root.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="kd">var</span> <span class="nx">_console</span> <span class="o">=</span> <span class="p">(</span><span class="nx">Josh</span><span class="p">.</span><span class="nx">Debug</span> <span class="o">&amp;&amp;</span> <span class="nx">root</span><span class="p">.</span><span class="nx">console</span><span class="p">)</span> <span class="o">?</span> <span class="nx">root</span><span class="p">.</span><span class="nx">console</span> <span class="o">:</span> <span class="p">{</span>
      <span class="nx">log</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="p">}</span>
    <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <h2>Console State</h2>

<p><code>_self</code> contains all state variables for the console's operation</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="kd">var</span> <span class="nx">_self</span> <span class="o">=</span> <span class="p">{</span>
      <span class="nx">shell</span><span class="o">:</span> <span class="nx">Josh</span><span class="p">.</span><span class="nx">Shell</span><span class="p">({</span><span class="nx">console</span><span class="o">:</span> <span class="nx">_console</span><span class="p">}),</span>
      <span class="nx">api</span><span class="o">:</span> <span class="s2">&quot;https://api.github.com/&quot;</span>
    <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p><code>Josh.PathHandler</code> is attached to <code>Josh.Shell</code> to provide basic file system navigation.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">_self</span><span class="p">.</span><span class="nx">pathhandler</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Josh</span><span class="p">.</span><span class="nx">PathHandler</span><span class="p">(</span><span class="nx">_self</span><span class="p">.</span><span class="nx">shell</span><span class="p">,</span> <span class="p">{</span><span class="nx">console</span><span class="o">:</span> <span class="nx">_console</span><span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <h2>Custom Templates</h2>

<p><code>Josh.Shell</code> uses <em>Underscore</em> templates for rendering output to the shell. This console overrides some and adds a couple of new ones for its own commands.</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p><strong>templates.prompt</strong></p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>Override of the default prompt to provide a multi-line prompt of the current user, repo and path and branch.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">_self</span><span class="p">.</span><span class="nx">shell</span><span class="p">.</span><span class="nx">templates</span><span class="p">.</span><span class="nx">prompt</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">template</span><span class="p">(</span><span class="s2">&quot;&lt;em&gt;[&lt;%= self.user.login %&gt;/&lt;%= self.repo.name %&gt;]&lt;/em&gt;&lt;/br&gt;(&lt;%=self.branch%&gt;) &lt;strong&gt;&lt;%= node.path %&gt; $&lt;/strong&gt;&quot;</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p><strong>templates.ls</strong></p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p>Override of the pathhandler ls template to create a multi-column listing.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">_self</span><span class="p">.</span><span class="nx">shell</span><span class="p">.</span><span class="nx">templates</span><span class="p">.</span><span class="nx">ls</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">template</span><span class="p">(</span><span class="s2">&quot;&lt;ul class=&#39;widelist&#39;&gt;&lt;% _.each(nodes, function(node) { %&gt;&lt;li&gt;&lt;%- node.name %&gt;&lt;/li&gt;&lt;% }); %&gt;&lt;/ul&gt;&lt;div class=&#39;clear&#39;/&gt;&quot;</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p><strong>templates.not_found</strong></p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p>Override of the pathhandler <em>not_found</em> template, since we will throw <em>not_found</em> if you try to access a valid file. This is done for the simplicity of the tutorial.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">_self</span><span class="p">.</span><span class="nx">shell</span><span class="p">.</span><span class="nx">templates</span><span class="p">.</span><span class="nx">not_found</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">template</span><span class="p">(</span><span class="s2">&quot;&lt;div&gt;&lt;%=cmd%&gt;: &lt;%=path%&gt;: No such directory&lt;/div&gt;&quot;</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <p><strong>templates.rateLimitTemplate</strong></p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <p>Since GitHub rate limits un-authenticated use rather drastically, we render the current rate limit status in the shell so that it is clear that extended experimenting requires authentication.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">_self</span><span class="p">.</span><span class="nx">shell</span><span class="p">.</span><span class="nx">templates</span><span class="p">.</span><span class="nx">rateLimitTemplate</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">template</span><span class="p">(</span><span class="s2">&quot;&lt;%=remaining%&gt;/&lt;%=limit%&gt;&lt;% if(noAuthToken) {%&gt; &lt;a href=&#39;http://josh.claassen.net/github&#39;&gt;Authenticate with Github to increase your Rate Limit.&lt;/a&gt;&lt;%}%&gt;&quot;</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <p><strong>templates.user</strong></p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <p>Render basic information (including gravatar) whenever we switch users or enter <code>user</code> without an argument</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">_self</span><span class="p">.</span><span class="nx">shell</span><span class="p">.</span><span class="nx">templates</span><span class="p">.</span><span class="nx">user</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">template</span><span class="p">(</span><span class="s2">&quot;&lt;div class=&#39;userinfo&#39;&gt;&quot;</span> <span class="o">+</span>
      <span class="s2">&quot;&lt;img src=&#39;&lt;%=user.avatar_url%&gt;&#39; style=&#39;float:right;&#39;/&gt;&quot;</span> <span class="o">+</span>
      <span class="s2">&quot;&lt;table&gt;&quot;</span> <span class="o">+</span>
      <span class="s2">&quot;&lt;tr&gt;&lt;td&gt;&lt;strong&gt;Id:&lt;/strong&gt;&lt;/td&gt;&lt;td&gt;&lt;%=user.id %&gt;&lt;/td&gt;&lt;/tr&gt;&quot;</span> <span class="o">+</span>
      <span class="s2">&quot;&lt;tr&gt;&lt;td&gt;&lt;strong&gt;Name:&lt;/strong&gt;&lt;/td&gt;&lt;td&gt;&lt;%=user.login %&gt;&lt;/td&gt;&lt;/tr&gt;&quot;</span> <span class="o">+</span>
      <span class="s2">&quot;&lt;tr&gt;&lt;td&gt;&lt;strong&gt;Location:&lt;/strong&gt;&lt;/td&gt;&lt;td&gt;&lt;%=user.location %&gt;&lt;/td&gt;&lt;/tr&gt;&quot;</span> <span class="o">+</span>
      <span class="s2">&quot;&lt;/table&gt;&quot;</span> <span class="o">+</span>
      <span class="s2">&quot;&lt;/div&gt;&quot;</span>
    <span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <p><strong>templates.user_error</strong>
Generic error in case setting the user fails.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">_self</span><span class="p">.</span><span class="nx">shell</span><span class="p">.</span><span class="nx">templates</span><span class="p">.</span><span class="nx">user_error</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">template</span><span class="p">(</span><span class="s2">&quot;Unable to set user &#39;&lt;%=name%&gt;&#39;: &lt;%=msg%&gt;&quot;</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>               <p><strong>templates.repos</strong>
Just like <code>ls</code>, we render a wide list of repositories for <code>repo -l</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">_self</span><span class="p">.</span><span class="nx">shell</span><span class="p">.</span><span class="nx">templates</span><span class="p">.</span><span class="nx">repos</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">template</span><span class="p">(</span><span class="s2">&quot;&lt;ul class=&#39;widelist&#39;&gt;&lt;% _.each(repos, function(repo) { %&gt;&lt;li&gt;&lt;%- repo.name %&gt;&lt;/li&gt;&lt;% }); %&gt;&lt;/ul&gt;&lt;div class=&#39;clear&#39;/&gt;&quot;</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-18">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-18">&#182;</a>               </div>               <p>Whenever we change repositories or <code>repo</code> is called without an argument, we show basic information about the repo.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">_self</span><span class="p">.</span><span class="nx">shell</span><span class="p">.</span><span class="nx">templates</span><span class="p">.</span><span class="nx">repo</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">template</span><span class="p">(</span><span class="s2">&quot;&lt;div&gt;&lt;div&gt;&lt;strong&gt;Name: &lt;/strong&gt;&lt;%=repo.full_name%&gt;&lt;/div&gt;&lt;div&gt;&lt;strong&gt;Description: &lt;/strong&gt;&lt;%=repo.description %&gt;&lt;/div&gt;&lt;/div&gt;&quot;</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-19">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-19">&#182;</a>               </div>               <p>Error in case someone tries to switch to an invalid repo.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">_self</span><span class="p">.</span><span class="nx">shell</span><span class="p">.</span><span class="nx">templates</span><span class="p">.</span><span class="nx">repo_not_found</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">template</span><span class="p">(</span><span class="s2">&quot;&lt;div&gt;repo: &lt;%=repo%&gt;: No such repo for user &#39;&lt;%= user %&gt;&#39;&lt;/div&gt;&quot;</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-20">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-20">&#182;</a>               </div>               <p>Generic error in case setting the repo fails.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">_self</span><span class="p">.</span><span class="nx">shell</span><span class="p">.</span><span class="nx">templates</span><span class="p">.</span><span class="nx">repo_error</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">template</span><span class="p">(</span><span class="s2">&quot;Unable to switch to repository &#39;&lt;%=name%&gt;&#39;: &lt;%=msg%&gt;&quot;</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-21">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-21">&#182;</a>               </div>               <p>Again, like <code>ls</code>, we render a wide like of branches for <code>branch -l</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">_self</span><span class="p">.</span><span class="nx">shell</span><span class="p">.</span><span class="nx">templates</span><span class="p">.</span><span class="nx">branches</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">template</span><span class="p">(</span><span class="s2">&quot;webfont.woff&lt;ul class=&#39;widelist&#39;&gt;&lt;% _.each(branches, function(branch) { %&gt;&lt;li&gt;&lt;%- branch.name %&gt;&lt;/li&gt;&lt;% }); %&gt;&lt;/ul&gt;&lt;div class=&#39;clear&#39;/&gt;&quot;</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-22">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-22">&#182;</a>               </div>               <p>Generic error in case setting the current branch fails.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">_self</span><span class="p">.</span><span class="nx">shell</span><span class="p">.</span><span class="nx">templates</span><span class="p">.</span><span class="nx">branch_error</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">template</span><span class="p">(</span><span class="s2">&quot;Unable to switch to branch &#39;&lt;%=name%&gt;&#39;: &lt;%=msg%&gt;&quot;</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-23">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-23">&#182;</a>               </div>               <p>Generic error in case fetching the list of branches fails.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">_self</span><span class="p">.</span><span class="nx">shell</span><span class="p">.</span><span class="nx">templates</span><span class="p">.</span><span class="nx">branches_error</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">template</span><span class="p">(</span><span class="s2">&quot;Unable to load branch list: &lt;%=msg%&gt;&quot;</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-24">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-24">&#182;</a>               </div>               <h2>Adding Commands to the Console</h2>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">_self</span><span class="p">.</span><span class="nx">shell</span><span class="p">.</span><span class="nx">setCommandHandler</span><span class="p">(</span><span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="p">{</span>
      <span class="nx">exec</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">cmd</span><span class="p">,</span> <span class="nx">args</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">args</span> <span class="o">||</span> <span class="nx">args</span><span class="p">.</span><span class="nx">length</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">callback</span><span class="p">(</span><span class="nx">_self</span><span class="p">.</span><span class="nx">shell</span><span class="p">.</span><span class="nx">templates</span><span class="p">.</span><span class="nx">user</span><span class="p">({</span><span class="nx">user</span><span class="o">:</span> <span class="nx">_self</span><span class="p">.</span><span class="nx">user</span><span class="p">}));</span>
        <span class="p">}</span>
        <span class="kd">var</span> <span class="nx">username</span> <span class="o">=</span> <span class="nx">args</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
        <span class="k">return</span> <span class="nx">setUser</span><span class="p">(</span><span class="nx">username</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span>
          <span class="kd">function</span><span class="p">(</span><span class="nx">msg</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">callback</span><span class="p">(</span><span class="nx">_self</span><span class="p">.</span><span class="nx">shell</span><span class="p">.</span><span class="nx">templates</span><span class="p">.</span><span class="nx">user_error</span><span class="p">({</span><span class="nx">name</span><span class="o">:</span> <span class="nx">username</span><span class="p">,</span> <span class="nx">msg</span><span class="o">:</span> <span class="nx">msg</span><span class="p">}));</span>
          <span class="p">},</span>
          <span class="kd">function</span><span class="p">(</span><span class="nx">user</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">callback</span><span class="p">(</span><span class="nx">_self</span><span class="p">.</span><span class="nx">shell</span><span class="p">.</span><span class="nx">templates</span><span class="p">.</span><span class="nx">user</span><span class="p">({</span><span class="nx">user</span><span class="o">:</span> <span class="nx">user</span><span class="p">}));</span>
          <span class="p">}</span>
        <span class="p">);</span>
      <span class="p">}</span>
    <span class="p">});</span>
    <span class="nx">_self</span><span class="p">.</span><span class="nx">shell</span><span class="p">.</span><span class="nx">setCommandHandler</span><span class="p">(</span><span class="s2">&quot;repo&quot;</span><span class="p">,</span> <span class="p">{</span>
      <span class="nx">exec</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">cmd</span><span class="p">,</span> <span class="nx">args</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">args</span> <span class="o">||</span> <span class="nx">args</span><span class="p">.</span><span class="nx">length</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">callback</span><span class="p">(</span><span class="nx">_self</span><span class="p">.</span><span class="nx">shell</span><span class="p">.</span><span class="nx">templates</span><span class="p">.</span><span class="nx">repo</span><span class="p">({</span><span class="nx">repo</span><span class="o">:</span> <span class="nx">_self</span><span class="p">.</span><span class="nx">repo</span><span class="p">}));</span>
        <span class="p">}</span>
        <span class="kd">var</span> <span class="nx">name</span> <span class="o">=</span> <span class="nx">args</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
        <span class="k">if</span><span class="p">(</span><span class="nx">name</span> <span class="o">===</span> <span class="s1">&#39;-l&#39;</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">callback</span><span class="p">(</span><span class="nx">_self</span><span class="p">.</span><span class="nx">shell</span><span class="p">.</span><span class="nx">templates</span><span class="p">.</span><span class="nx">repos</span><span class="p">({</span><span class="nx">repos</span><span class="o">:</span> <span class="nx">_self</span><span class="p">.</span><span class="nx">repos</span><span class="p">}));</span>
        <span class="p">}</span>
        <span class="kd">var</span> <span class="nx">repo</span> <span class="o">=</span> <span class="nx">getRepo</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">_self</span><span class="p">.</span><span class="nx">repos</span><span class="p">);</span>
        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">repo</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">callback</span><span class="p">(</span><span class="nx">_self</span><span class="p">.</span><span class="nx">shell</span><span class="p">.</span><span class="nx">templates</span><span class="p">.</span><span class="nx">repo_error</span><span class="p">({</span><span class="nx">name</span><span class="o">:</span> <span class="nx">name</span><span class="p">,</span> <span class="nx">msg</span><span class="o">:</span> <span class="s1">&#39;no such repo&#39;</span><span class="p">}));</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nx">setRepo</span><span class="p">(</span><span class="nx">repo</span><span class="p">,</span>
          <span class="kd">function</span><span class="p">(</span><span class="nx">msg</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">callback</span><span class="p">(</span><span class="nx">_self</span><span class="p">.</span><span class="nx">shell</span><span class="p">.</span><span class="nx">templates</span><span class="p">.</span><span class="nx">repo_error</span><span class="p">({</span><span class="nx">name</span><span class="o">:</span> <span class="nx">name</span><span class="p">,</span> <span class="nx">msg</span><span class="o">:</span> <span class="nx">msg</span><span class="p">}));</span>
          <span class="p">},</span>
          <span class="kd">function</span><span class="p">(</span><span class="nx">repo</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">repo</span><span class="p">)</span> <span class="p">{</span>
              <span class="k">return</span> <span class="nx">callback</span><span class="p">(</span><span class="nx">_self</span><span class="p">.</span><span class="nx">shell</span><span class="p">.</span><span class="nx">templates</span><span class="p">.</span><span class="nx">repo_not_found</span><span class="p">({</span><span class="nx">repo</span><span class="o">:</span> <span class="nx">name</span><span class="p">,</span> <span class="nx">user</span><span class="o">:</span> <span class="nx">_self</span><span class="p">.</span><span class="nx">user</span><span class="p">.</span><span class="nx">login</span><span class="p">}));</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="nx">callback</span><span class="p">(</span><span class="nx">_self</span><span class="p">.</span><span class="nx">shell</span><span class="p">.</span><span class="nx">templates</span><span class="p">.</span><span class="nx">repo</span><span class="p">({</span><span class="nx">repo</span><span class="o">:</span> <span class="nx">_self</span><span class="p">.</span><span class="nx">repo</span><span class="p">}));</span>
          <span class="p">}</span>
        <span class="p">);</span>
      <span class="p">},</span>
      <span class="nx">completion</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">cmd</span><span class="p">,</span> <span class="nx">arg</span><span class="p">,</span> <span class="nx">line</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">callback</span><span class="p">(</span><span class="nx">_self</span><span class="p">.</span><span class="nx">shell</span><span class="p">.</span><span class="nx">bestMatch</span><span class="p">(</span><span class="nx">arg</span><span class="p">,</span> <span class="nx">_</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">_self</span><span class="p">.</span><span class="nx">repos</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">repo</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">repo</span><span class="p">.</span><span class="nx">name</span><span class="p">;</span>
        <span class="p">})));</span>
      <span class="p">}</span>
    <span class="p">});</span>
    <span class="nx">_self</span><span class="p">.</span><span class="nx">shell</span><span class="p">.</span><span class="nx">setCommandHandler</span><span class="p">(</span><span class="s2">&quot;branch&quot;</span><span class="p">,</span> <span class="p">{</span>
      <span class="nx">exec</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">cmd</span><span class="p">,</span> <span class="nx">args</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">args</span> <span class="o">||</span> <span class="nx">args</span><span class="p">.</span><span class="nx">length</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">callback</span><span class="p">(</span><span class="nx">_self</span><span class="p">.</span><span class="nx">branch</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="kd">var</span> <span class="nx">branch</span> <span class="o">=</span> <span class="nx">args</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
        <span class="k">if</span><span class="p">(</span><span class="nx">branch</span> <span class="o">===</span> <span class="s1">&#39;-l&#39;</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">ensureBranches</span><span class="p">(</span>
            <span class="kd">function</span><span class="p">(</span><span class="nx">msg</span><span class="p">)</span> <span class="p">{</span>
              <span class="nx">callback</span><span class="p">(</span><span class="nx">_self</span><span class="p">.</span><span class="nx">shell</span><span class="p">.</span><span class="nx">templates</span><span class="p">.</span><span class="nx">branches_error</span><span class="p">({</span><span class="nx">msg</span><span class="o">:</span> <span class="nx">msg</span><span class="p">}));</span>
            <span class="p">},</span>
            <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
              <span class="k">return</span> <span class="nx">callback</span><span class="p">(</span><span class="nx">_self</span><span class="p">.</span><span class="nx">shell</span><span class="p">.</span><span class="nx">templates</span><span class="p">.</span><span class="nx">branches</span><span class="p">({</span><span class="nx">branches</span><span class="o">:</span> <span class="nx">_self</span><span class="p">.</span><span class="nx">branches</span><span class="p">}));</span>
            <span class="p">}</span>
          <span class="p">);</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nx">getDir</span><span class="p">(</span><span class="nx">_self</span><span class="p">.</span><span class="nx">repo</span><span class="p">.</span><span class="nx">full_name</span><span class="p">,</span> <span class="nx">branch</span><span class="p">,</span> <span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">node</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">callback</span><span class="p">(</span><span class="nx">_self</span><span class="p">.</span><span class="nx">shell</span><span class="p">.</span><span class="nx">templates</span><span class="p">.</span><span class="nx">branch_error</span><span class="p">({</span><span class="nx">name</span><span class="o">:</span> <span class="nx">branch</span><span class="p">,</span> <span class="nx">msg</span><span class="o">:</span> <span class="s2">&quot;unable to load root directory for branch&quot;</span><span class="p">}));</span>
          <span class="p">}</span>
          <span class="nx">_self</span><span class="p">.</span><span class="nx">branch</span> <span class="o">=</span> <span class="nx">branch</span><span class="p">;</span>
          <span class="nx">_self</span><span class="p">.</span><span class="nx">pathhandler</span><span class="p">.</span><span class="nx">current</span> <span class="o">=</span> <span class="nx">node</span><span class="p">;</span>
          <span class="nx">callback</span><span class="p">();</span>
        <span class="p">});</span>
      <span class="p">},</span>
      <span class="nx">completion</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">cmd</span><span class="p">,</span> <span class="nx">arg</span><span class="p">,</span> <span class="nx">line</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">ensureBranches</span><span class="p">(</span>
          <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="nx">callback</span><span class="p">();</span>
          <span class="p">},</span>
          <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="nx">callback</span><span class="p">(</span><span class="nx">_self</span><span class="p">.</span><span class="nx">shell</span><span class="p">.</span><span class="nx">bestMatch</span><span class="p">(</span><span class="nx">arg</span><span class="p">,</span> <span class="nx">_</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">_self</span><span class="p">.</span><span class="nx">branches</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">branch</span><span class="p">)</span> <span class="p">{</span>
              <span class="k">return</span> <span class="nx">branch</span><span class="p">.</span><span class="nx">name</span><span class="p">;</span>
            <span class="p">})));</span>
          <span class="p">}</span>
        <span class="p">);</span>
      <span class="p">}</span>
    <span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-25">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-25">&#182;</a>               </div>               <p>prompt configuration</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">_self</span><span class="p">.</span><span class="nx">shell</span><span class="p">.</span><span class="nx">onNewPrompt</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">callback</span><span class="p">(</span><span class="nx">_self</span><span class="p">.</span><span class="nx">shell</span><span class="p">.</span><span class="nx">templates</span><span class="p">.</span><span class="nx">prompt</span><span class="p">({</span><span class="nx">self</span><span class="o">:</span> <span class="nx">_self</span><span class="p">,</span> <span class="nx">node</span><span class="o">:</span> <span class="nx">_self</span><span class="p">.</span><span class="nx">pathhandler</span><span class="p">.</span><span class="nx">current</span><span class="p">}));</span>
    <span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-26">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-26">&#182;</a>               </div>               <p>wiring up pathhandler for navigating repository file system</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">_self</span><span class="p">.</span><span class="nx">pathhandler</span><span class="p">.</span><span class="nx">getNode</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">path</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">_console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;looking for node at: &quot;</span> <span class="o">+</span> <span class="nx">path</span><span class="p">);</span>
      <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">path</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">callback</span><span class="p">(</span><span class="nx">_self</span><span class="p">.</span><span class="nx">pathhandler</span><span class="p">.</span><span class="nx">current</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="kd">var</span> <span class="nx">parts</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">),</span> <span class="kd">function</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">x</span><span class="p">;</span>
      <span class="p">});</span>
      <span class="nx">_console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">parts</span><span class="p">);</span>
      <span class="k">if</span><span class="p">(</span><span class="nx">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">===</span> <span class="s2">&quot;..&quot;</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">_console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;looking for parent relative&quot;</span><span class="p">);</span>
        <span class="kd">var</span> <span class="nx">parentParts</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">_self</span><span class="p">.</span><span class="nx">pathhandler</span><span class="p">.</span><span class="nx">current</span><span class="p">.</span><span class="nx">path</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">),</span> <span class="kd">function</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">x</span><span class="p">;</span>
        <span class="p">});</span>
        <span class="k">if</span><span class="p">(</span><span class="nx">parentParts</span><span class="p">.</span><span class="nx">length</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">callback</span><span class="p">(</span><span class="nx">_self</span><span class="p">.</span><span class="nx">pathhandler</span><span class="p">.</span><span class="nx">current</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="nx">path</span> <span class="o">=</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="nx">parentParts</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">parentParts</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">).</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="nx">parts</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="nx">join</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="nx">path</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!==</span> <span class="s1">&#39;/&#39;</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">_console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;looking for current relative&quot;</span><span class="p">);</span>
        <span class="k">if</span><span class="p">(</span><span class="nx">_self</span><span class="p">.</span><span class="nx">pathhandler</span><span class="p">.</span><span class="nx">current</span><span class="p">.</span><span class="nx">path</span> <span class="o">===</span> <span class="s1">&#39;/&#39;</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">path</span> <span class="o">=</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="nx">path</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="nx">path</span> <span class="o">=</span> <span class="nx">_self</span><span class="p">.</span><span class="nx">pathhandler</span><span class="p">.</span><span class="nx">current</span><span class="p">.</span><span class="nx">path</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="nx">path</span><span class="p">;</span>
        <span class="p">}</span>
      <span class="p">}</span>
      <span class="nx">_console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;path to fetch: &quot;</span> <span class="o">+</span> <span class="nx">path</span><span class="p">);</span>
      <span class="k">return</span> <span class="nx">getDir</span><span class="p">(</span><span class="nx">_self</span><span class="p">.</span><span class="nx">repo</span><span class="p">.</span><span class="nx">full_name</span><span class="p">,</span> <span class="nx">_self</span><span class="p">.</span><span class="nx">branch</span><span class="p">,</span> <span class="nx">path</span><span class="p">,</span> <span class="nx">callback</span><span class="p">);</span>
    <span class="p">};</span>
    <span class="nx">_self</span><span class="p">.</span><span class="nx">pathhandler</span><span class="p">.</span><span class="nx">getChildNodes</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span><span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">isfile</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">_console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;it&#39;s a file, no children&quot;</span><span class="p">);</span>
        <span class="k">return</span> <span class="nx">callback</span><span class="p">();</span>
      <span class="p">}</span>
      <span class="k">if</span><span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">children</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">_console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;got children, let&#39;s turn them into nodes&quot;</span><span class="p">);</span>
        <span class="k">return</span> <span class="nx">callback</span><span class="p">(</span><span class="nx">makeNodes</span><span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">children</span><span class="p">));</span>
      <span class="p">}</span>
      <span class="nx">_console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;no children, fetch them&quot;</span><span class="p">);</span>
      <span class="k">return</span> <span class="nx">getDir</span><span class="p">(</span><span class="nx">_self</span><span class="p">.</span><span class="nx">repo</span><span class="p">.</span><span class="nx">full_name</span><span class="p">,</span> <span class="nx">_self</span><span class="p">.</span><span class="nx">branch</span><span class="p">,</span> <span class="nx">node</span><span class="p">.</span><span class="nx">path</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">detailNode</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">node</span><span class="p">.</span><span class="nx">children</span> <span class="o">=</span> <span class="nx">detailNode</span><span class="p">.</span><span class="nx">children</span><span class="p">;</span>
        <span class="nx">callback</span><span class="p">(</span><span class="nx">makeNodes</span><span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">children</span><span class="p">));</span>
      <span class="p">});</span>
    <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-27">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-27">&#182;</a>               </div>               <p>supporting functions</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="kd">function</span> <span class="nx">get</span><span class="p">(</span><span class="nx">resource</span><span class="p">,</span> <span class="nx">args</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span> <span class="nx">_self</span><span class="p">.</span><span class="nx">api</span> <span class="o">+</span> <span class="nx">resource</span><span class="p">;</span>
      <span class="k">if</span><span class="p">(</span><span class="nx">_self</span><span class="p">.</span><span class="nx">access_token</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">args</span> <span class="o">=</span> <span class="nx">args</span> <span class="o">||</span> <span class="p">{};</span>
        <span class="nx">args</span><span class="p">.</span><span class="nx">access_token</span> <span class="o">=</span> <span class="nx">_self</span><span class="p">.</span><span class="nx">access_token</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">if</span><span class="p">(</span><span class="nx">args</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">url</span> <span class="o">+=</span> <span class="s2">&quot;?&quot;</span> <span class="o">+</span> <span class="nx">_</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">args</span><span class="p">,</span><span class="kd">function</span><span class="p">(</span><span class="nx">v</span><span class="p">,</span> <span class="nx">k</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">k</span> <span class="o">+</span> <span class="s2">&quot;=&quot;</span> <span class="o">+</span> <span class="nx">v</span><span class="p">;</span>
        <span class="p">}).</span><span class="nx">join</span><span class="p">(</span><span class="s2">&quot;&amp;&quot;</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="nx">_console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;fetching: &quot;</span> <span class="o">+</span> <span class="nx">url</span><span class="p">);</span>
      <span class="kd">var</span> <span class="nx">request</span> <span class="o">=</span> <span class="p">{</span>
        <span class="nx">url</span><span class="o">:</span> <span class="nx">url</span><span class="p">,</span>
        <span class="nx">dataType</span><span class="o">:</span> <span class="s1">&#39;jsonp&#39;</span>
      <span class="p">};</span>
      <span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">(</span><span class="nx">request</span><span class="p">).</span><span class="nx">done</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">_console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">meta</span><span class="p">);</span>
        <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#ratelimit&#39;</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="nx">_self</span><span class="p">.</span><span class="nx">shell</span><span class="p">.</span><span class="nx">templates</span><span class="p">.</span><span class="nx">rateLimitTemplate</span><span class="p">({</span>
          <span class="nx">remaining</span><span class="o">:</span> <span class="nx">response</span><span class="p">.</span><span class="nx">meta</span><span class="p">[</span><span class="s2">&quot;X-RateLimit-Remaining&quot;</span><span class="p">],</span>
          <span class="nx">limit</span><span class="o">:</span> <span class="nx">response</span><span class="p">.</span><span class="nx">meta</span><span class="p">[</span><span class="s2">&quot;X-RateLimit-Limit&quot;</span><span class="p">],</span>
          <span class="nx">noAuthToken</span><span class="o">:</span> <span class="o">!</span><span class="nx">_self</span><span class="p">.</span><span class="nx">access_token</span>
        <span class="p">}));</span>
        <span class="k">if</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">meta</span><span class="p">[</span><span class="s2">&quot;X-RateLimit-Remaining&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">alert</span><span class="p">(</span><span class="s2">&quot;Whoops, you&#39;ve hit the github rate limit. You&#39;ll need to authenticate to continue&quot;</span><span class="p">);</span>
          <span class="nx">_self</span><span class="p">.</span><span class="nx">shell</span><span class="p">.</span><span class="nx">deactivate</span><span class="p">();</span>
          <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">if</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">meta</span><span class="p">.</span><span class="nx">status</span> <span class="o">!=</span> <span class="mi">200</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">callback</span><span class="p">();</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nx">callback</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">data</span><span class="p">);</span>
      <span class="p">})</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">ensureBranches</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">get</span><span class="p">(</span><span class="s2">&quot;repos/&quot;</span> <span class="o">+</span> <span class="nx">_self</span><span class="p">.</span><span class="nx">repo</span><span class="p">.</span><span class="nx">full_name</span> <span class="o">+</span> <span class="s2">&quot;/branches&quot;</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">branches</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">branches</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">err</span><span class="p">(</span><span class="s2">&quot;api request failed to return branch list&quot;</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="nx">_self</span><span class="p">.</span><span class="nx">branches</span> <span class="o">=</span> <span class="nx">branches</span><span class="p">;</span>
        <span class="k">return</span> <span class="nx">callback</span><span class="p">();</span>
      <span class="p">});</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">setUser</span><span class="p">(</span><span class="nx">user_name</span><span class="p">,</span> <span class="nx">repo_name</span><span class="p">,</span> <span class="nx">err</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span><span class="p">(</span><span class="nx">_self</span><span class="p">.</span><span class="nx">user</span> <span class="o">&amp;&amp;</span> <span class="nx">_self</span><span class="p">.</span><span class="nx">user</span><span class="p">.</span><span class="nx">login</span> <span class="o">===</span> <span class="nx">user_name</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">callback</span><span class="p">(</span><span class="nx">_self</span><span class="p">.</span><span class="nx">user</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">get</span><span class="p">(</span><span class="s2">&quot;users/&quot;</span> <span class="o">+</span> <span class="nx">user_name</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">user</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">user</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">err</span><span class="p">(</span><span class="s2">&quot;no such user&quot;</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nx">initializeRepos</span><span class="p">(</span><span class="nx">user</span><span class="p">,</span> <span class="nx">repo_name</span><span class="p">,</span> <span class="nx">err</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">repo</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">_self</span><span class="p">.</span><span class="nx">user</span> <span class="o">=</span> <span class="nx">user</span><span class="p">;</span>
          <span class="k">return</span> <span class="nx">callback</span><span class="p">(</span><span class="nx">_self</span><span class="p">.</span><span class="nx">user</span><span class="p">);</span>
        <span class="p">});</span>
      <span class="p">});</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">initializeRepos</span><span class="p">(</span><span class="nx">user</span><span class="p">,</span> <span class="nx">repo_name</span><span class="p">,</span> <span class="nx">err</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">getRepos</span><span class="p">(</span><span class="nx">user</span><span class="p">.</span><span class="nx">login</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">repos</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">repo</span> <span class="o">=</span> <span class="nx">getRepo</span><span class="p">(</span><span class="nx">repo_name</span><span class="p">,</span> <span class="nx">repos</span><span class="p">);</span>
        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">repo</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">err</span><span class="p">(</span><span class="s2">&quot;user has no repositories&quot;</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nx">setRepo</span><span class="p">(</span><span class="nx">repo</span><span class="p">,</span> <span class="nx">err</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">repo</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">_self</span><span class="p">.</span><span class="nx">repos</span> <span class="o">=</span> <span class="nx">repos</span><span class="p">;</span>
          <span class="k">return</span> <span class="nx">callback</span><span class="p">(</span><span class="nx">repo</span><span class="p">);</span>
        <span class="p">});</span>
      <span class="p">});</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">getDir</span><span class="p">(</span><span class="nx">repo_full_name</span><span class="p">,</span> <span class="nx">branch</span><span class="p">,</span> <span class="nx">path</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span><span class="p">(</span><span class="nx">path</span> <span class="o">&amp;&amp;</span> <span class="nx">path</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="nx">path</span><span class="p">[</span><span class="nx">path</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">===</span> <span class="s1">&#39;/&#39;</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">path</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">path</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="nx">get</span><span class="p">(</span><span class="s2">&quot;repos/&quot;</span> <span class="o">+</span> <span class="nx">repo_full_name</span> <span class="o">+</span> <span class="s2">&quot;/contents&quot;</span> <span class="o">+</span> <span class="nx">path</span><span class="p">,</span> <span class="p">{</span><span class="nx">ref</span><span class="o">:</span> <span class="nx">branch</span><span class="p">},</span> <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="nb">Object</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">toString</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="o">!==</span> <span class="s1">&#39;[object Array]&#39;</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">_console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;path &#39;&quot;</span> <span class="o">+</span> <span class="nx">path</span> <span class="o">+</span> <span class="s2">&quot;&#39; was a file&quot;</span><span class="p">);</span>
          <span class="k">return</span> <span class="nx">callback</span><span class="p">();</span>
        <span class="p">}</span>
        <span class="kd">var</span> <span class="nx">node</span> <span class="o">=</span> <span class="p">{</span>
          <span class="nx">name</span><span class="o">:</span> <span class="nx">_</span><span class="p">.</span><span class="nx">last</span><span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">),</span> <span class="kd">function</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">x</span><span class="p">;</span>
          <span class="p">}))</span> <span class="o">||</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
          <span class="nx">path</span><span class="o">:</span> <span class="nx">path</span><span class="p">,</span>
          <span class="nx">children</span><span class="o">:</span> <span class="nx">data</span>
        <span class="p">};</span>
        <span class="nx">_console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;got node at: &quot;</span> <span class="o">+</span> <span class="nx">node</span><span class="p">.</span><span class="nx">path</span><span class="p">);</span>
        <span class="k">return</span> <span class="nx">callback</span><span class="p">(</span><span class="nx">node</span><span class="p">);</span>
      <span class="p">});</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">getRepos</span><span class="p">(</span><span class="nx">userLogin</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">get</span><span class="p">(</span><span class="s2">&quot;users/&quot;</span> <span class="o">+</span> <span class="nx">userLogin</span> <span class="o">+</span> <span class="s2">&quot;/repos&quot;</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">callback</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
      <span class="p">});</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">getRepo</span><span class="p">(</span><span class="nx">repo_name</span><span class="p">,</span> <span class="nx">repos</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">repos</span> <span class="o">||</span> <span class="nx">repos</span><span class="p">.</span><span class="nx">length</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="kd">var</span> <span class="nx">repo</span><span class="p">;</span>
      <span class="k">if</span><span class="p">(</span><span class="nx">repo_name</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">repo</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="nx">repos</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">repo</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">repo</span><span class="p">.</span><span class="nx">name</span> <span class="o">===</span> <span class="nx">repo_name</span><span class="p">;</span>
        <span class="p">});</span>
        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">repo</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">callback</span><span class="p">();</span>
        <span class="p">}</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">repo</span> <span class="o">=</span> <span class="nx">repos</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">repo</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">setRepo</span><span class="p">(</span><span class="nx">repo</span><span class="p">,</span> <span class="nx">err</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">getDir</span><span class="p">(</span><span class="nx">repo</span><span class="p">.</span><span class="nx">full_name</span><span class="p">,</span> <span class="nx">repo</span><span class="p">.</span><span class="nx">default_branch</span><span class="p">,</span> <span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">node</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">err</span><span class="p">(</span><span class="s2">&quot;could not initialize root directory of repository &#39;&quot;</span> <span class="o">+</span> <span class="nx">repo</span><span class="p">.</span><span class="nx">full_name</span> <span class="o">+</span> <span class="s2">&quot;&#39;&quot;</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="nx">_console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;setting repo to &#39;&quot;</span> <span class="o">+</span> <span class="nx">repo</span><span class="p">.</span><span class="nx">name</span> <span class="o">+</span> <span class="s2">&quot;&#39;&quot;</span><span class="p">);</span>
        <span class="nx">_self</span><span class="p">.</span><span class="nx">repo</span> <span class="o">=</span> <span class="nx">repo</span><span class="p">;</span>
        <span class="nx">_self</span><span class="p">.</span><span class="nx">branch</span> <span class="o">=</span> <span class="nx">repo</span><span class="p">.</span><span class="nx">default_branch</span><span class="p">;</span>
        <span class="nx">_self</span><span class="p">.</span><span class="nx">pathhandler</span><span class="p">.</span><span class="nx">current</span> <span class="o">=</span> <span class="nx">node</span><span class="p">;</span>
        <span class="k">return</span> <span class="nx">callback</span><span class="p">(</span><span class="nx">repo</span><span class="p">);</span>
      <span class="p">});</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">makeNodes</span><span class="p">(</span><span class="nx">children</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">_</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">children</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="p">{</span>
          <span class="nx">name</span><span class="o">:</span> <span class="nx">node</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span>
          <span class="nx">path</span><span class="o">:</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="nx">node</span><span class="p">.</span><span class="nx">path</span><span class="p">,</span>
          <span class="nx">isFile</span><span class="o">:</span> <span class="nx">node</span><span class="p">.</span><span class="nx">type</span> <span class="o">===</span> <span class="s1">&#39;file&#39;</span>
        <span class="p">};</span>
      <span class="p">});</span>
    <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-28">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-28">&#182;</a>               </div>               <p><section id='initialize'/></p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-29">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-29">&#182;</a>               </div>               <p>Initializes the Shell either as the authenticated user or the default user <em>sdether</em></p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="kd">function</span> <span class="nx">initialize</span><span class="p">(</span><span class="nx">access_token</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">_self</span><span class="p">.</span><span class="nx">access_token</span> <span class="o">=</span> <span class="nx">access_token</span><span class="p">;</span>
      <span class="k">if</span><span class="p">(</span><span class="nx">_self</span><span class="p">.</span><span class="nx">access_token</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">get</span><span class="p">(</span><span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">user</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">user</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">initializationError</span><span class="p">(</span><span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="s2">&quot;unable able to fetch default user&quot;</span><span class="p">);</span>
          <span class="p">}</span>
          <span class="nx">_console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;intializing w/ user &#39;&quot;</span> <span class="o">+</span> <span class="nx">user</span><span class="p">.</span><span class="nx">login</span> <span class="o">+</span> <span class="s2">&quot;&#39;&quot;</span><span class="p">);</span>
          <span class="k">return</span> <span class="nx">initializeRepos</span><span class="p">(</span><span class="nx">user</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span>
            <span class="kd">function</span><span class="p">(</span><span class="nx">msg</span><span class="p">)</span> <span class="p">{</span>
              <span class="nx">initializationError</span><span class="p">(</span><span class="s2">&quot;repo init&quot;</span><span class="p">,</span> <span class="nx">msg</span><span class="p">);</span>
            <span class="p">},</span>
            <span class="kd">function</span><span class="p">(</span><span class="nx">repo</span><span class="p">)</span> <span class="p">{</span>
              <span class="nx">_self</span><span class="p">.</span><span class="nx">user</span> <span class="o">=</span> <span class="nx">user</span><span class="p">;</span>
              <span class="nx">initializeUI</span><span class="p">();</span>
            <span class="p">}</span>
          <span class="p">);</span>
        <span class="p">});</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">_console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;initializing default w/ &#39;sdether&#39;&quot;</span><span class="p">);</span>
        <span class="nx">setUser</span><span class="p">(</span><span class="s2">&quot;sdether&quot;</span><span class="p">,</span> <span class="s2">&quot;josh.js&quot;</span><span class="p">,</span>
          <span class="kd">function</span><span class="p">(</span><span class="nx">msg</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">initializationError</span><span class="p">(</span><span class="s2">&quot;default&quot;</span><span class="p">,</span> <span class="nx">msg</span><span class="p">);</span>
          <span class="p">},</span>
          <span class="nx">initializeUI</span>
        <span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">initializationError</span><span class="p">(</span><span class="nx">context</span><span class="p">,</span> <span class="nx">msg</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">_console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;[&quot;</span> <span class="o">+</span> <span class="nx">context</span> <span class="o">+</span> <span class="s2">&quot;] failed to initialize: &quot;</span> <span class="o">+</span> <span class="nx">msg</span><span class="p">);</span>
      <span class="nx">alert</span><span class="p">(</span><span class="s2">&quot;unable to initialize shell. Encountered a problem talking to github api. Try reloading the page&quot;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">initializeUI</span><span class="p">()</span> <span class="p">{</span>
      <span class="nx">_console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;activating&quot;</span><span class="p">);</span>
      <span class="kd">var</span> <span class="nx">$consolePanel</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#shell-container&#39;</span><span class="p">);</span>
      <span class="nx">$consolePanel</span><span class="p">.</span><span class="nx">resizable</span><span class="p">({</span> <span class="nx">handles</span><span class="o">:</span> <span class="s2">&quot;s&quot;</span><span class="p">});</span>
      <span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">keypress</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="nx">_self</span><span class="p">.</span><span class="nx">shell</span><span class="p">.</span><span class="nx">isActive</span><span class="p">())</span> <span class="p">{</span>
          <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">if</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">keyCode</span> <span class="o">==</span> <span class="mi">126</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
          <span class="nx">activateAndShow</span><span class="p">();</span>
        <span class="p">}</span>
      <span class="p">});</span>
      <span class="kd">function</span> <span class="nx">activateAndShow</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">_self</span><span class="p">.</span><span class="nx">shell</span><span class="p">.</span><span class="nx">activate</span><span class="p">();</span>
        <span class="nx">$consolePanel</span><span class="p">.</span><span class="nx">slideDown</span><span class="p">();</span>
        <span class="nx">$consolePanel</span><span class="p">.</span><span class="nx">focus</span><span class="p">();</span>
      <span class="p">}</span>

      <span class="kd">function</span> <span class="nx">hideAndDeactivate</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">_self</span><span class="p">.</span><span class="nx">shell</span><span class="p">.</span><span class="nx">deactivate</span><span class="p">();</span>
        <span class="nx">$consolePanel</span><span class="p">.</span><span class="nx">slideUp</span><span class="p">();</span>
        <span class="nx">$consolePanel</span><span class="p">.</span><span class="nx">blur</span><span class="p">();</span>
      <span class="p">}</span>

      <span class="nx">_self</span><span class="p">.</span><span class="nx">shell</span><span class="p">.</span><span class="nx">onEOT</span><span class="p">(</span><span class="nx">hideAndDeactivate</span><span class="p">);</span>
      <span class="nx">_self</span><span class="p">.</span><span class="nx">shell</span><span class="p">.</span><span class="nx">onCancel</span><span class="p">(</span><span class="nx">hideAndDeactivate</span><span class="p">);</span>
    <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-30">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-30">&#182;</a>               </div>               <p>initialization &amp; activation</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">ready</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
        <span class="nx">url</span><span class="o">:</span> <span class="s1">&#39;http://josh.claassen.net/github-token&#39;</span><span class="p">,</span>
        <span class="nx">type</span><span class="o">:</span> <span class="s2">&quot;get&quot;</span><span class="p">,</span>
        <span class="nx">dataType</span><span class="o">:</span> <span class="s2">&quot;json&quot;</span><span class="p">,</span>
        <span class="nx">xhrFields</span><span class="o">:</span> <span class="p">{</span>
          <span class="nx">withCredentials</span><span class="o">:</span> <span class="kc">true</span>
        <span class="p">}</span>
      <span class="p">})</span>
        <span class="p">.</span><span class="nx">done</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">_console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
          <span class="nx">initialize</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">access_token</span><span class="p">);</span>
        <span class="p">});</span>
    <span class="p">});</span>
  <span class="p">})(</span><span class="nx">root</span><span class="p">,</span> <span class="nx">$</span><span class="p">,</span> <span class="nx">_</span><span class="p">);</span>
<span class="p">})(</span><span class="k">this</span><span class="p">,</span> <span class="nx">$</span><span class="p">,</span> <span class="nx">_</span><span class="p">);</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 